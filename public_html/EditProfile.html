<!DOCTYPE html>
<!--
Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
Click nbfs://nbhost/SystemFileSystem/Templates/ClientSide/html.html to edit this template
-->
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </head>
    <body>
     
    <!-- Edit Customer Modal -->
    <div id="editCustomerModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('editCustomerModal')">&times;</span>
            <h2>Edit Customer</h2>
            <form id="editCustomerForm">
                <input type="hidden" id="editCustomerId">
                <label for="editCustomerName">Name:</label>
                <input type="text" id="editCustomerName" name="name" required>
                <label for="editCustomerEmail">Email:</label>
                <input type="email" id="editCustomerEmail" name="email" required>
                <button type="submit">Save Changes</button>
            </form>
        </div>
    </div>
    </body>
    <script type="module">
        // Import Firebase modules
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
        import { getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, getDocs, setDoc } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";
	import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
	import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-analytics.js";

    // Your web app's Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyAauhTRKCxnwpXvfdvRMXfU1K9oFvYgRRE",
        authDomain: "login-b62bd.firebaseapp.com",
        projectId: "login-b62bd",
        storageBucket: "login-b62bd.appspot.com",
        messagingSenderId: "861930818449",
        appId: "1:861930818449:web:1c5f962893ca85ecf5a830",
        measurementId: "G-KHJSX85R56"
    };

   let app;
if (!initializeApp.length) {
    app = initializeApp(firebaseConfig);
} else {
    app = initializeApp(firebaseConfig);
}

const auth = getAuth(app);
const db = getFirestore(app);
const analytics = getAnalytics(app);
        // Function to add an employee
          document.getElementById('addEmployeeForm').addEventListener('submit', async function(event) {
            event.preventDefault();
            const name = document.getElementById('addEmployeeName').value;
            const email = document.getElementById('addEmployeeEmail').value;
            const password = document.getElementById('addEmployeePassword').value;
            const role = document.getElementById('addEmployeeRole').value;
            const department = document.getElementById('addEmployeeDepartment').value;
           const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user; 
  const userDocRef = doc(db, "employees", user.uid);
        await setDoc(userDocRef, {
            name: name,
            email: email,
            role: role,
            department: department,
            uid: user.uid // Store the uid in the document itself
        });

                alert("Employee added successfully!");
                location.reload();  // Reload page after adding employee
            alert(`New Employee Added.\nName: ${name}\nEmail: ${email}\nRole: ${role}\nDepartment: ${department}`);
            
            closeModal('addEmployeeModal');
        });

        // Function to add a customer
        async function addCustomer(name, email) {
            try {
                await addDoc(collection(db, 'customers'), {
                    name: name,
                    email: email
                });
                alert("Customer added successfully!");
                location.reload();  // Reload page after adding customer
            } catch (e) {
                console.error("Error adding document: ", e);
            }
        }

        // Function to edit employee
          document.getElementById('editEmployeeForm').addEventListener('submit', async function(event) {
            event.preventDefault();
            const id = document.getElementById('editEmployeeId').value;
            const name = document.getElementById('editEmployeeName').value;
            const email = document.getElementById('editEmployeeEmail').value;
            const role = document.getElementById('editEmployeeRole').value;
            const department = document.getElementById('editEmployeeDepartment').value;
 try {
                const employeeRef = doc(db, 'employees', id);
                await updateDoc(employeeRef, {
                    name: name,
                    email: email,
                    role: role,
                    department: department
                });
                alert("Employee updated successfully!");
                location.reload();  // Reload page after updating employee
            } catch (e) {
                console.error("Error updating document: ", e);
            }
            alert(`Employee with ID: ${id} has been updated.\nName: ${name}\nEmail: ${email}\nRole: ${role}\nDepartment: ${department}`);
            closeModal('editEmployeeModal');
        });

        // Function to delete employee
   document.getElementById('deleteEmployeeForm').addEventListener('submit', async function(event) {
            event.preventDefault();
            const id = document.getElementById('deleteEmployeeId').value;
                try {
                    const employeeRef = doc(db, 'employees', id);
                    await deleteDoc(employeeRef);
                    alert("Employee deleted successfully!");
                    location.reload();  // Reload page after deleting employee
                } catch (e) {
                    console.error("Error deleting document: ", e);
                }
            
        });

        // Function to delete customer
        async function deleteCustomer(id) {
            if (confirm("Are you sure you want to delete this customer?")) {
                try {
                    const customerRef = doc(db, 'customers', id);
                    await deleteDoc(customerRef);
                    alert("Customer deleted successfully!");
                    location.reload();  // Reload page after deleting customer
                } catch (e) {
                    console.error("Error deleting document: ", e);
                }
            }
        }

        // Function to load data from Firestore (employees and customers)
        async function loadData() {
            const employeeTableBody = document.querySelector("#employeeTable tbody");
            const customerTableBody = document.querySelector("#customerTable tbody");

            // Fetch all employees
            const employeesSnapshot = await getDocs(collection(db, "employees"));
            employeesSnapshot.forEach((doc) => {
                const employee = doc.data();
                const row = `<tr>
                    <td>${doc.id}</td>
                    <td>${employee.name}</td>
                    <td>${employee.email}</td>
                    <td>${employee.role}</td>
                    <td>${employee.department}</td>
                    <td>
                        <button class="edit-btn" onclick="openEditEmployeeModal('${doc.id}', '${employee.name}', '${employee.email}', '${employee.role}', '${employee.department}')">Edit</button>
                        <button class="delete-btn" onclick="openDeleteModal('${doc.id}')">Delete</button>
                    </td>
                </tr>`;
                employeeTableBody.innerHTML += row;
            });

            // Fetch all customers
            const customersSnapshot = await getDocs(collection(db, "Customers"));
            customersSnapshot.forEach((doc) => {
                const customer = doc.data();
                const row = `<tr>
                    <td>${doc.id}</td>
                    <td>${customer.Name}</td>
                    <td>${customer.Email}</td>
                    <td>
                        <button class="edit-btn" onclick="openEditCustomerModal('${doc.id}', '${customer.Name}', '${customer.Email}')">Edit</button>
                        <button class="delete-btn" onclick="deleteCustomer('${doc.id}')">Delete</button>
                    </td>
                </tr>`;
                customerTableBody.innerHTML += row;
            });
        }

        window.addEventListener("load", loadData);
        
    </script>
    <script>
        // Open Modal
        function openModal(modalId) {
            document.getElementById(modalId).style.display = "block";
        }

        // Close Modal
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = "none";
        }

        // Handle form submission for adding an employee
      

        // Handle form submission for editing an employee
  

        // Handle form submission for adding a customer
        document.getElementById('addCustomerForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const name = document.getElementById('addCustomerName').value;
            const email = document.getElementById('addCustomerEmail').value;

            alert(`New Customer Added.\nName: ${name}\nEmail: ${email}`);
            closeModal('addCustomerModal');
        });

        // Handle form submission for editing a customer
        document.getElementById('editCustomerForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const id = document.getElementById('editCustomerId').value;
            const name = document.getElementById('editCustomerName').value;
            const email = document.getElementById('editCustomerEmail').value;

            alert(`Customer with ID: ${id} has been updated.\nName: ${name}\nEmail: ${email}`);
            closeModal('editCustomerModal');
        });

        // Delete employee function
         

        // Delete customer function
        function deleteCustomer(customerId) {
            if (confirm('Are you sure you want to delete customer with ID: ' + customerId + '?')) {
                alert('Customer with ID: ' + customerId + ' has been deleted.');
                // Implement the delete customer functionality
            }
        }
    
        // Open Add Employee Modal
        function openEmployeeModal() {
            openModal('addEmployeeModal');
        }

        // Open Add Customer Modal
        function openDeleteModal(id) {
            document.getElementById('deleteEmployeeId').value = id;
            openModal('deleteModal');
        }

        // Open Edit Employee Modal
        function openEditEmployeeModal(id, name, email, role, department) {
            document.getElementById('editEmployeeId').value = id;
            document.getElementById('editEmployeeName').value = name;
            document.getElementById('editEmployeeEmail').value = email;
            document.getElementById('editEmployeeRole').value = role;
            document.getElementById('editEmployeeDepartment').value = department;
            openModal('editEmployeeModal');
        }

        // Open Edit Customer Modal
        function openEditCustomerModal(id, name, email) {
            document.getElementById('editCustomerId').value = id;
            document.getElementById('editCustomerName').value = name;
            document.getElementById('editCustomerEmail').value = email;
            openModal('editCustomerModal');
        }
    </script>
</html>
